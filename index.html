<!doctype html>
<html lang="es">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <meta name="theme-color" content="#0b5ed7">
  <title>TurnApp ‚Äî Gesti√≥n Inteligente de Turnos de Trabajo</title>
  <link rel="manifest" href="manifest.json">
  <link rel="stylesheet" href="app.css">
</head>
<body class="light">

  <!-- Pantalla inicial / Splash -->
  <div id="splash" class="splash">
    <div class="logo-wrap">
      <img src="logo.svg" alt="TurnApp logo" class="logo-img" id="splash-logo">
    </div>
    <h1 class="slogan">Gesti√≥n Inteligente de Turnos de Trabajo</h1>
  </div>

  <!-- App principal -->
<main id="app" class="oculto">
    <header class="app-header">
      <h2 id="app-title">TurnApp</h2>
      <button id="btn-toggle-theme" class="icon-btn" aria-label="Cambiar tema">üåì</button>
    </header>

    <!-- ========= PANEL 1: TURNOS (Calendario y Licencias) ========= -->
    <section id="content" class="content panel">
      <p>Bienvenido a <strong>TurnApp</strong></p>

      <div style="margin-top:12px; margin-bottom:25px; text-align:center;">
        <button id="btn-apply-cadence" class="modern-btn green">Aplicar cadencia</button>
        <button id="btn-clear-cadence" class="modern-btn red">Limpiar cadencia</button>
      </div>

      <div class="calendar-controls">
        <button id="prevMonth">‚óÄ Anterior</button>
        <span id="monthLabel"></span>
        <button id="nextMonth">Siguiente ‚ñ∂</button>
      </div>

      <div id="calendar-weekdays">
        <div>LUN</div><div>MAR</div><div>MI√â</div><div>JUE</div><div>VIE</div><div>S√ÅB</div><div>DOM</div>
      </div>

      <section id="calendar-panel">
        <div id="calendar"></div>
      </section>

    <!-- ========= PANEL 2: PETICIONES (Caj√≥n y Tabla) ========= -->
    <section id="ajustes-section" class="panel oculto">
      <h2>Gesti√≥n de Peticiones</h2>
      <div class="peticiones-zona">
        <h3>Zona Usuario</h3>
        <textarea id="peticion-texto" placeholder="Escribe aqu√≠ tu petici√≥n..."></textarea>
        <div class="peticiones-controles">
          <button id="enviar-peticion">Enviar petici√≥n</button>
        </div>
        <ul id="lista-peticiones-usuario" class="lista-peticiones"></ul>
      </div>
    
      <button id="limpiar-tabla" class="modern-btn red">üßπ Limpiar tabla</button>
      <table id="tabla-coordinador">
        <colgroup><col><col><col><col><col><col><col><col></colgroup>
        <thead>
          <tr>
            <th colspan="2">FUNCIONARIO/A</th>
            <th colspan="5" contenteditable="true" class="titulo-ciclo">CICLO</th>
            <th colspan="true">OBSERVACIONES</th>
          </tr>
          <tr>
            <th>N¬∫</th><th>NOMBRE</th><th>M¬π</th><th>T¬π</th><th>M¬≤</th><th>T¬≤</th><th>N</th><th contenteditable="true">COCINA</th>
          </tr>
        </thead>
        <tbody>
          <!-- 18 filas de la tabla -->
          <tr><td contenteditable="true"></td><td contenteditable="true"></td><td contenteditable="true"></td><td contenteditable="true"></td><td contenteditable="true"></td><td contenteditable="true"></td><td contenteditable="true"></td><td contenteditable="true"></td></tr>
          <tr><td contenteditable="true"></td><td contenteditable="true"></td><td contenteditable="true"></td><td contenteditable="true"></td><td contenteditable="true"></td><td contenteditable="true"></td><td contenteditable="true"></td><td contenteditable="true"></td></tr>
          <tr><td contenteditable="true"></td><td contenteditable="true"></td><td contenteditable="true"></td><td contenteditable="true"></td><td contenteditable="true"></td><td contenteditable="true"></td><td contenteditable="true"></td><td contenteditable="true"></td></tr>
          <tr><td contenteditable="true"></td><td contenteditable="true"></td><td contenteditable="true"></td><td contenteditable="true"></td><td contenteditable="true"></td><td contenteditable="true"></td><td contenteditable="true"></td><td contenteditable="true"></td></tr>
          <tr><td contenteditable="true"></td><td contenteditable="true"></td><td contenteditable="true"></td><td contenteditable="true"></td><td contenteditable="true"></td><td contenteditable="true"></td><td contenteditable="true"></td><td contenteditable="true"></td></tr>
          <tr><td contenteditable="true"></td><td contenteditable="true"></td><td contenteditable="true"></td><td contenteditable="true"></td><td contenteditable="true"></td><td contenteditable="true"></td><td contenteditable="true"></td><td contenteditable="true"></td></tr>
          <tr><td contenteditable="true"></td><td contenteditable="true"></td><td contenteditable="true"></td><td contenteditable="true"></td><td contenteditable="true"></td><td contenteditable="true"></td><td contenteditable="true"></td><td contenteditable="true"></td></tr>
          <tr><td contenteditable="true"></td><td contenteditable="true"></td><td contenteditable="true"></td><td contenteditable="true"></td><td contenteditable="true"></td><td contenteditable="true"></td><td contenteditable="true"></td><td contenteditable="true"></td></tr>
          <tr><td contenteditable="true"></td><td contenteditable="true"></td><td contenteditable="true"></td><td contenteditable="true"></td><td contenteditable="true"></td><td contenteditable="true"></td><td contenteditable="true"></td><td contenteditable="true"></td></tr>
          <tr><td contenteditable="true"></td><td contenteditable="true"></td><td contenteditable="true"></td><td contenteditable="true"></td><td contenteditable="true"></td><td contenteditable="true"></td><td contenteditable="true"></td><td contenteditable="true"></td></tr>
          <tr><td contenteditable="true"></td><td contenteditable="true"></td><td contenteditable="true"></td><td contenteditable="true"></td><td contenteditable="true"></td><td contenteditable="true"></td><td contenteditable="true"></td><td contenteditable="true"></td></tr>
          <tr><td contenteditable="true"></td><td contenteditable="true"></td><td contenteditable="true"></td><td contenteditable="true"></td><td contenteditable="true"></td><td contenteditable="true"></td><td contenteditable="true"></td><td contenteditable="true"></td></tr>
          <tr><td contenteditable="true"></td><td contenteditable="true"></td><td contenteditable="true"></td><td contenteditable="true"></td><td contenteditable="true"></td><td contenteditable="true"></td><td contenteditable="true"></td><td contenteditable="true"></td></tr>
          <tr><td contenteditable="true"></td><td contenteditable="true"></td><td contenteditable="true"></td><td contenteditable="true"></td><td contenteditable="true"></td><td contenteditable="true"></td><td contenteditable="true"></td><td contenteditable="true"></td></tr>
          <tr><td contenteditable="true"></td><td contenteditable="true"></td><td contenteditable="true"></td><td contenteditable="true"></td><td contenteditable="true"></td><td contenteditable="true"></td><td contenteditable="true"></td><td contenteditable="true"></td></tr>
          <tr><td contenteditable="true"></td><td contenteditable="true"></td><td contenteditable="true"></td><td contenteditable="true"></td><td contenteditable="true"></td><td contenteditable="true"></td><td contenteditable="true"></td><td contenteditable="true"></td></tr>
          <tr><td contenteditable="true"></td><td contenteditable="true"></td><td contenteditable="true"></td><td contenteditable="true"></td><td contenteditable="true"></td><td contenteditable="true"></td><td contenteditable="true"></td><td contenteditable="true"></td></tr>
          <tr><td contenteditable="true"></td><td contenteditable="true"></td><td contenteditable="true"></td><td contenteditable="true"></td><td contenteditable="true"></td><td contenteditable="true"></td><td contenteditable="true"></td><td contenteditable="true"></td></tr>
        </tbody>
      </table>

      <!-- CONTROLES PARA A√ëADIR/QUITAR FILAS -->
      <div id="tabla-coordinador-controles" style="text-align: right; margin-top: 10px; margin-bottom: 15px;">
        <button id="btn-add-row" class="modern-btn green">(+) Fila</button>
        <button id="btn-remove-row" class="modern-btn red">(-) Fila</button>
    </div>
   </section>

    <!-- ========= PANEL 3: TABL√ìN DE ANUNCIOS ========= -->
    <section id="tablon-section" class="panel oculto">
      <h2>Tabl√≥n de Anuncios</h2>
      <div class="tablon-controles" style="text-align: center; margin-bottom: 20px;">
        <button id="btn-upload-file" class="modern-btn green">[+] Subir Archivo</button>
      </div>
      <div id="tablon-lista">
        <!-- Los archivos subidos aparecer√°n aqu√≠ -->
      </div>
    </section>

<!-- ===== PANEL 4: CARGA DE D√çAS Y LICENCIAS (NUEVO PANEL INDEPENDIENTE) ===== -->
<section id="carga-dias-section" class="panel oculto">
<div id="licencias-container" class="licencias oculto" aria-hidden="true" style="margin-top:20px;">
        <h3>Gesti√≥n de Permisos y Licencias</h3>
        <div class="licencia-item" data-tipo="vacaciones"><label class="licencia-nombre">Vacaciones: V</label><input type="number" min="0" class="cantidad-input licencia-cantidad" value="0"><button type="button" class="licencia-color-handle licencia-color" title="Elegir color">‚óè</button></div>
        <div class="licencia-item" data-tipo="compfest"><label class="licencia-nombre">Compensaci√≥n de Festivos: CF</label><input type="number" min="0" class="cantidad-input licencia-cantidad" value="0"><button type="button" class="licencia-color-handle licencia-color" title="Elegir color">‚óè</button></div>
        <div class="licencia-item" data-tipo="asuntos"><label class="licencia-nombre">Asuntos Propios: AP</label><input type="number" min="0" class="cantidad-input licencia-cantidad" value="0"><button type="button" class="licencia-color-handle licencia-color" title="Elegir color">‚óè</button></div>
        <div class="licencia-item" data-tipo="delegacion"><label class="licencia-nombre">Delegaci√≥n de Gobierno: DG</label><input type="number" min="0" class="cantidad-input licencia-cantidad" value="0"><button type="button" class="licencia-color-handle licencia-color" title="Elegir color">‚óè</button></div>
        <div class="licencia-item" data-tipo="adicionales"><label class="licencia-nombre">D√≠as Adicionales: DA</label><input type="number" min="0" class="cantidad-input licencia-cantidad" value="0"><button type="button" class="licencia-color-handle licencia-color" title="Elegir color">‚óè</button></div>
        <div class="licencia-item" data-tipo="acumuladas"><label class="licencia-nombre">Jornadas Acumuladas: JA</label><input type="number" min="0" class="cantidad-input licencia-cantidad" value="0"><button type="button" class="licencia-color-handle licencia-color" title="Elegir color">‚óè</button></div>
        <div class="licencia-item" data-tipo="otros"><label class="licencia-nombre">Otros: O</label><input type="number" min="0" class="cantidad-input licencia-cantidad" value="0"><button type="button" class="licencia-color-handle licencia-color" title="Elegir color">‚óè</button></div>
        <div class="licencia-item" data-tipo="baja_medica"><label class="licencia-nombre">Baja M√©dica: BM</label><input type="number" min="0" class="cantidad-input licencia-cantidad" value="0"><button type="button" class="licencia-color-handle licencia-color" title="Elegir color">‚óè</button></div>
        <div class="licencia-item" data-tipo="articulo_48"><label class="licencia-nombre">Art√≠culo 48: AR</label><input type="number" min="0" class="cantidad-input licencia-cantidad" value="0"><button type="button" class="licencia-color-handle licencia-color" title="Elegir color">‚óè</button></div>
        <div class="licencia-item" data-tipo="deber_inexcusable"><label class="licencia-nombre">Deber Inexcusable: DI</label><input type="number" min="0" class="cantidad-input licencia-cantidad" value="0"><button type="button" class="licencia-color-handle licencia-color" title="Elegir color">‚óè</button></div>
        <hr>
        <div class="licencia-total"><label class="licencia-nombre"><strong>Total:</strong></label><input type="text" id="total-licencias" readonly class="licencia-cantidad" value="0"></div>
      </div>
</section>

    <!-- ========= NAVEGACI√ìN INFERIOR ========= -->
    <nav class="bottom-nav" role="navigation" aria-label="Navegaci√≥n principal">
      <button data-section="turnos" class="nav-btn active">Calendario</button>
      <button data-section="peticiones" class="nav-btn">Peticiones</button>
      <button id="btn-carga-dias" data-section="ajustes" class="nav-btn">Carga D√≠as</button>
      <button data-section="tablon" class="nav-btn">Tabl√≥n</button>
      <button id="btn-install-pwa" class="nav-btn" style="display: none;">‚¨áÔ∏è Instalar</button>
    </nav>
</main>


  <!-- MODAL CADENCIAS (transl√∫cido) -->
  <div id="cadence-modal-overlay" class="modal-overlay" aria-hidden="true" style="display:none;">
    <div id="cadence-modal" class="modal-card" role="dialog" aria-modal="true" aria-labelledby="cadence-title">
      <h3 id="cadence-title">Seleccione la cadencia</h3>

      <div class="modal-section">
        <label class="modal-label">Tipo:</label>
        <div class="modal-row">
          <button data-type="V-1" class="modal-type-btn">V-1</button>
          <button data-type="V-2" class="modal-type-btn">V-2</button>
          <button data-type="Personalizada" class="modal-type-btn">Personalizada</button>
        </div>
      </div>

      <div id="v1-options" class="modal-section" style="display:none;">
        <label class="modal-label">Opciones V-1:</label>
        <div class="modal-row radio-row">
          <label><input type="radio" name="v1opt" value="0"> 1 ‚Äî M/T, L, M/T, N, L, L, L, L</label>
          <label><input type="radio" name="v1opt" value="1"> 2 ‚Äî M/T, M/T, N, L, L, L, L, L</label>
          <label><input type="radio" name="v1opt" value="2"> 3 ‚Äî T, M/T, M/N, L, L, L, L, L</label>
          <label><input type="radio" name="v1opt" value="3"> 4 ‚Äî M/T, N, L, L, L</label>
          <label><input type="radio" name="v1opt" value="4"> 5 ‚Äî T, M/N, L, L, L</label>
        </div>
      </div>

      <div id="v2-options" class="modal-section" style="display:none;">
        <label class="modal-label">V-2: patr√≥n fijo de 6 d√≠as (M/T, M/T, L, L, L, L)</label>
      </div>

      <div id="custom-section" class="modal-section" style="display:none;">
        <label class="modal-label">Patr√≥n personalizado (separado por comas):</label>
        <input id="custom-pattern" type="text" placeholder="ej: M/T, L, M/T, N, L, L, L, L" style="width:100%;padding:8px;border-radius:6px;border:1px solid #ccc;">
      </div>

      <div class="modal-section">
        <label class="modal-label">Fecha inicio (DD/MM/AAAA):</label>
        <input id="cadence-start" type="text" placeholder="DD/MM/AAAA" style="width:140px;padding:8px;border-radius:6px;border:1px solid #ccc;">
      </div>

      <div class="modal-actions">
        <button id="apply-cadence-confirm" class="modal-action primary">Aplicar</button>
        <button id="close-cadence" class="modal-action">Cerrar</button>
      </div>
    </div>
  </div>

  <script src="app.js" defer></script>

<script>
document.addEventListener('DOMContentLoaded', () => {

    // --- 1. ELEMENTOS Y PANELES (A√ëADIDO EL TABL√ìN) ---
    const appContainer = document.getElementById('app');
    const mainContent = document.getElementById('content');
    const ajustesSection = document.getElementById('ajustes-section');
    const tablonSection = document.getElementById('tablon-section'); // <-- A√ëADIDO
    const licenciasContainer = document.getElementById('licencias-container');
    const calendarPanel = document.getElementById('calendar-panel');
    const cargaDiasSection = document.getElementById('carga-dias-section');

    const navButtons = document.querySelectorAll('.nav-btn');
    const btnTurnos = document.querySelector('.nav-btn[data-section="turnos"]');
    const btnPeticiones = document.querySelector('.nav-btn[data-section="peticiones"]');
    const btnTablon = document.querySelector('.nav-btn[data-section="tablon"]'); // <-- A√ëADIDO
    const btnCargaDias = document.getElementById('btn-carga-dias');

    // --- 2. L√ìGICA DE NAVEGACI√ìN (MODIFICADA PARA EL TABL√ìN) ---
    function switchPanel(targetSection) {
        // Ocultamos todos los paneles principales
        mainContent.classList.add('oculto');
        ajustesSection.classList.add('oculto');
        tablonSection.classList.add('oculto'); // <-- A√ëADIDO
        cargaDiasSection.classList.add('oculto');
        // Tambi√©n nos aseguramos de que los sub-paneles est√©n ocultos al cambiar
        licenciasContainer.classList.add('oculto');

        // Mostramos el panel principal correcto
        if (targetSection === 'turnos') {
            mainContent.classList.remove('oculto');
            appContainer.scrollIntoView({ behavior: 'smooth', block: 'start' });
        } else if (targetSection === 'peticiones') {
            ajustesSection.classList.remove('oculto');
            ajustesSection.scrollIntoView({ behavior: 'smooth', block: 'start' });
        } else if (targetSection === 'tablon') { // <-- A√ëADIDO
            tablonSection.classList.remove('oculto');
            tablonSection.scrollIntoView({ behavior: 'smooth', block: 'start' });
        } else if (targetSection === 'carga-dias') { 
            cargaDiasSection.classList.remove('oculto');
        }

        // Actualizamos el bot√≥n activo
        navButtons.forEach(btn => {
            btn.classList.toggle('active', btn.dataset.section === targetSection);
        });
    }

    // Bot√≥n "Calendario"
    btnTurnos.addEventListener('click', () => {
        switchPanel('turnos');
    });

    // Bot√≥n "Peticiones" (Mantiene su l√≥gica original)
    btnPeticiones.addEventListener('click', () => {
        const isAjustesVisible = !ajustesSection.classList.contains('oculto');
        if (isAjustesVisible) {
            switchPanel('turnos'); // Si ya est√° visible, vuelve a turnos
        } else {
            switchPanel('peticiones');
        }
    });

    // Bot√≥n "Tabl√≥n" (NUEVO)
    btnTablon.addEventListener('click', () => {
        const isTablonVisible = !tablonSection.classList.contains('oculto');
        if (isTablonVisible) {
            switchPanel('turnos'); // Si ya est√° visible, vuelve a turnos
        } else {
            switchPanel('tablon');
        }
    });

    // Bot√≥n "Carga D√≠as" (Mantiene su l√≥gica original)
    btnCargaDias.addEventListener('click', () => {
    switchPanel('carga-dias');
   });

        
        const isLicenciasHidden = licenciasContainer.classList.contains('oculto');
        if (isLicenciasHidden) {
            licenciasContainer.classList.remove('oculto');
            licenciasContainer.scrollIntoView({ behavior: 'smooth', block: 'start' });
        } else {
            licenciasContainer.classList.add('oculto');
            calendarPanel.scrollIntoView({ behavior: 'smooth', block: 'start' });
        }
    });

    // --- 3. L√ìGICA DE C√ÅLCULO DE LICENCIAS (INTACTA) ---
    const totalLicenciasField = document.getElementById('total-licencias');
    const cantidadInputs = Array.from(document.querySelectorAll('#licencias-container .cantidad-input'));
    if (totalLicenciasField && cantidadInputs.length > 0) {
      const recalculateTotal = () => {
        let total = 0;
        cantidadInputs.forEach(input => total += Number(input.value) || 0);
        totalLicenciasField.value = total;
      };
      cantidadInputs.forEach(input => input.addEventListener('input', recalculateTotal));
      recalculateTotal();
    }

    // --- 4. L√ìGICA DE GESTI√ìN DE PETICIONES (INTACTA) ---
    const textoPeticionInput = document.getElementById('peticion-texto');
    const enviarPeticionBtn = document.getElementById('enviar-peticion');
    const listaPeticionesUsuario = document.getElementById('lista-peticiones-usuario');
    if (textoPeticionInput && enviarPeticionBtn && listaPeticionesUsuario) {
        const PETICIONES_KEY = 'turnapp.peticiones.usuario';
        let peticiones = JSON.parse(localStorage.getItem(PETICIONES_KEY) || '[]');
        const esAdmin = true;
        const saveAndRenderPeticiones = () => {
            localStorage.setItem(PETICIONES_KEY, JSON.stringify(peticiones));
            listaPeticionesUsuario.innerHTML = '';
            peticiones.forEach((p, index) => {
                const li = document.createElement('li');
                li.className = 'peticion-item';
                if (p.revisada) li.classList.add('revisada');
                const fechaStr = p.fechaHora ? new Date(p.fechaHora).toLocaleString('es-ES', { day: '2-digit', month: '2-digit', hour: '2-digit', minute: '2-digit' }) : '';
                li.innerHTML = `<div class="peticion-contenido" style="flex: 1; text-align: left; word-break: break-word;"><span>${p.texto}</span><span class="fecha-hora" style="display: block; font-size: 0.8em; color: #555;">${fechaStr}</span></div><div class="peticion-acciones" style="display: flex; align-items: center; gap: 8px;"><input type="checkbox" title="Marcar como revisada" ${p.revisada ? 'checked' : ''}>${esAdmin ? '<button title="Eliminar" class="btn-eliminar" style="background: none; border: none; cursor: pointer; font-size: 1.1em; color: #c00;">‚ùå</button>' : ''}</div>`;
                li.querySelector('input[type="checkbox"]').addEventListener('change', (e) => { peticiones[index].revisada = e.target.checked; saveAndRenderPeticiones(); });
                if (esAdmin) { li.querySelector('.btn-eliminar').addEventListener('click', () => { peticiones.splice(index, 1); saveAndRenderPeticiones(); }); }
                listaPeticionesUsuario.appendChild(li);
            });
        };
        enviarPeticionBtn.addEventListener('click', () => { const texto = textoPeticionInput.value.trim(); if (!texto) return alert('Por favor, escribe una petici√≥n.'); peticiones.unshift({ texto, revisada: false, fechaHora: new Date().toISOString() }); textoPeticionInput.value = ''; saveAndRenderPeticiones(); });
        const peticionesZona = listaPeticionesUsuario.closest('.peticiones-zona');
        if (peticionesZona && esAdmin && !peticionesZona.querySelector('.btn-borrar-todo')) { const botonBorrarTodo = document.createElement('button'); botonBorrarTodo.textContent = 'üßπ Borrar Todo'; botonBorrarTodo.className = 'btn-borrar-todo'; botonBorrarTodo.addEventListener('click', () => { if (confirm('¬øEst√°s seguro de que quieres borrar TODAS las peticiones?')) { peticiones = []; saveAndRenderPeticiones(); } }); listaPeticionesUsuario.after(botonBorrarTodo); }
        saveAndRenderPeticiones();
    }

    // --- 5. INICIALIZACI√ìN DE LA VISTA (INTACTA) ---
    switchPanel('turnos');

    // --- 6. L√ìGICA DE INSTALACI√ìN PWA (INTACTA) ---
    let deferredPrompt;
    const installButton = document.getElementById('btn-install-pwa');

    window.addEventListener('beforeinstallprompt', (e) => {
      e.preventDefault();
      deferredPrompt = e;
      if (installButton) {
        installButton.style.display = 'block';
      }
    });

    if (installButton) {
      installButton.addEventListener('click', async () => {
        if (deferredPrompt) {
          deferredPrompt.prompt();
          const { outcome } = await deferredPrompt.userChoice;
          console.log(`Respuesta del usuario al di√°logo de instalaci√≥n: ${outcome}`);
          deferredPrompt = null;
          installButton.style.display = 'none';
        }
      });
    }

    window.addEventListener('appinstalled', () => {
      if (installButton) {
        installButton.style.display = 'none';
      }
      deferredPrompt = null;
      console.log('PWA fue instalada');
    });
});
</script>

</body>
</html>