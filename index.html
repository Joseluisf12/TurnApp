
<!doctype html>
<html lang="es">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <meta name="theme-color" content="#0b5ed7">
  <title>TurnApp ‚Äî Gesti√≥n Inteligente de Turnos de Trabajo</title>
  <link rel="manifest" href="manifest.json">
  <link rel="stylesheet" href="app.css">
<script src="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/2.16.105/pdf.min.js"></script>
</head>
<body class="light">

  <!-- Pantalla inicial / Splash -->
  <div id="splash" class="splash">
    <div class="logo-wrap">
      <img src="logo.svg" alt="TurnApp logo" class="logo-img" id="splash-logo">
    </div>
    <h1 class="slogan">Gesti√≥n Inteligente de Turnos de Trabajo</h1>
  </div>

  <!-- App principal -->
<main id="app" class="oculto">
    <header class="app-header">
      <h2 id="app-title">TurnApp</h2>
      <button id="btn-toggle-theme" class="icon-btn" aria-label="Cambiar tema">üåì</button>
    </header>

    <!-- ========= PANEL 1: TURNOS (Calendario y Licencias) ========= -->
    <section id="content" class="content panel">
      <div id="editable-title" contenteditable="true" spellcheck="false">Guardia 1 Teixeiro</div>


      <div style="margin-top:12px; margin-bottom:25px; text-align:center;">
        <button id="btn-apply-cadence" class="modern-btn green">Aplicar cadencia</button>
        <button id="btn-clear-cadence" class="modern-btn red">Limpiar cadencia</button>
      </div>

      <div class="calendar-controls">
        <button id="prevMonth">‚óÄ Anterior</button>
        <span id="monthLabel"></span>
        <button id="nextMonth">Siguiente ‚ñ∂</button>
      </div>

      <div id="calendar-weekdays">
        <div>LUN</div><div>MAR</div><div>MI√â</div><div>JUE</div><div>VIE</div><div>S√ÅB</div><div>DOM</div>
      </div>

      <section id="calendar-panel">
        <div id="calendar"></div>
      </section>

       
<!-- ========================================================================= -->
<!-- SECCI√ìN DE CARGA DE D√çAS (LICENCIAS) - REEMPLAZAR POR COMPLETO ESTE BLOQUE -->
<!-- ========================================================================= -->
<div id="licencias-container" class="licencias oculto" aria-hidden="true" style="margin-top:20px;">
    <h3>Gesti√≥n de Permisos y Licencias</h3>

    <!-- CABECERA PARA LAS COLUMNAS DE D√çAS -->
    <div class="licencia-header">
        <div class="licencia-nombre-header">Tipo de Permiso</div>
        <div class="licencia-valores-header">
            <span>Carga</span>
            <span>Consumidos</span>
            <span>Restan</span>
        </div>
        <div class="licencia-color-header">Color</div>
    </div>

    <!-- LISTA DE ITEMS DE LICENCIA (MODIFICADOS) -->
    <div class="licencia-item" data-tipo="vacaciones">
        <div class="licencia-nombre">Vacaciones: V</div>
        <div class="licencia-valores">
            <input type="number" class="licencia-input carga" min="0" max="99" value="0">
            <input type="number" class="licencia-input consumidos" min="0" max="99" value="0">
            <input type="number" class="licencia-input restan" readonly>
        </div>
        <button class="licencia-color licencia-color-handle" title="Elegir color">‚óè</button>
    </div>
    <div class="licencia-item" data-tipo="compfest">
        <div class="licencia-nombre">Compensaci√≥n Festivos: CF</div>
        <div class="licencia-valores">
            <input type="number" class="licencia-input carga" min="0" max="99" value="0">
            <input type="number" class="licencia-input consumidos" min="0" max="99" value="0">
            <input type="number" class="licencia-input restan" readonly>
        </div>
        <button class="licencia-color licencia-color-handle" title="Elegir color">‚óè</button>
    </div>
    <div class="licencia-item" data-tipo="asuntos">
        <div class="licencia-nombre">Asuntos Propios: AP</div>
        <div class="licencia-valores">
            <input type="number" class="licencia-input carga" min="0" max="99" value="0">
            <input type="number" class="licencia-input consumidos" min="0" max="99" value="0">
            <input type="number" class="licencia-input restan" readonly>
        </div>
        <button class="licencia-color licencia-color-handle" title="Elegir color">‚óè</button>
    </div>
    <div class="licencia-item" data-tipo="delegacion">
        <div class="licencia-nombre">Delegaci√≥n de Gobierno: DG</div>
        <div class="licencia-valores">
            <input type="number" class="licencia-input carga" min="0" max="99" value="0">
            <input type="number" class="licencia-input consumidos" min="0" max="99" value="0">
            <input type="number" class="licencia-input restan" readonly>
        </div>
        <button class="licencia-color licencia-color-handle" title="Elegir color">‚óè</button>
    </div>
    <div class="licencia-item" data-tipo="adicionales">
        <div class="licencia-nombre">D√≠as Adicionales: DA</div>
        <div class="licencia-valores">
            <input type="number" class="licencia-input carga" min="0" max="99" value="0">
            <input type="number" class="licencia-input consumidos" min="0" max="99" value="0">
            <input type="number" class="licencia-input restan" readonly>
        </div>
        <button class="licencia-color licencia-color-handle" title="Elegir color">‚óè</button>
    </div>
    <div class="licencia-item" data-tipo="acumuladas">
        <div class="licencia-nombre">Jornadas Acumuladas: JA</div>
        <div class="licencia-valores">
            <input type="number" class="licencia-input carga" min="0" max="99" value="0">
            <input type="number" class="licencia-input consumidos" min="0" max="99" value="0">
            <input type="number" class="licencia-input restan" readonly>
        </div>
        <button class="licencia-color licencia-color-handle" title="Elegir color">‚óè</button>
    </div>
    <div class="licencia-item" data-tipo="otros">
        <div class="licencia-nombre">Otros: O</div>
        <div class="licencia-valores">
            <input type="number" class="licencia-input carga" min="0" max="99" value="0">
            <input type="number" class="licencia-input consumidos" min="0" max="99" value="0">
            <input type="number" class="licencia-input restan" readonly>
        </div>
        <button class="licencia-color licencia-color-handle" title="Elegir color">‚óè</button>
    </div>
    <div class="licencia-item" data-tipo="baja_medica">
        <div class="licencia-nombre">Baja M√©dica: BM</div>
        <div class="licencia-valores">
            <input type="number" class="licencia-input carga" min="0" max="99" value="0">
            <input type="number" class="licencia-input consumidos" min="0" max="99" value="0">
            <input type="number" class="licencia-input restan" readonly>
        </div>
        <button class="licencia-color licencia-color-handle" title="Elegir color">‚óè</button>
    </div>
    <div class="licencia-item" data-tipo="articulo_48">
        <div class="licencia-nombre">Art√≠culo 48: AR</div>
        <div class="licencia-valores">
            <input type="number" class="licencia-input carga" min="0" max="99" value="0">
            <input type="number" class="licencia-input consumidos" min="0" max="99" value="0">
            <input type="number" class="licencia-input restan" readonly>
        </div>
        <button class="licencia-color licencia-color-handle" title="Elegir color">‚óè</button>
    </div>
    <div class="licencia-item" data-tipo="deber_inexcusable">
        <div class="licencia-nombre">Deber Inexcusable: DI</div>
        <div class="licencia-valores">
            <input type="number" class="licencia-input carga" min="0" max="99" value="0">
            <input type="number" class="licencia-input consumidos" min="0" max="99" value="0">
            <input type="number" class="licencia-input restan" readonly>
        </div>
        <button class="licencia-color licencia-color-handle" title="Elegir color">‚óè</button>
    </div>
    
    <hr>

    <!-- TOTALIZADOR CON 3 COLUMNAS -->
    <div class="licencia-total">
        <div class="licencia-nombre"><strong>Total:</strong></div>
        <div class="licencia-valores">
            <input type="number" id="total-carga" class="licencia-input" readonly>
            <input type="number" id="total-consumidos" class="licencia-input" readonly>
            <input type="number" id="total-restan" class="licencia-input" readonly>
        </div>
        <div class="licencia-color-placeholder"></div> <!-- Espacio para alinear -->
    </div>
</div>

    </section>

    <!-- ========= PANEL 2: PETICIONES (Caj√≥n y Tabla) ========= -->
    <section id="ajustes-section" class="panel oculto">
      <h2>Gesti√≥n de Peticiones</h2>
      <div class="peticiones-zona">
        <h3>Zona Usuario</h3>
        <textarea id="peticion-texto" placeholder="Escribe aqu√≠ tu petici√≥n..."></textarea>
        <div class="peticiones-controles">
          <button id="enviar-peticion">Enviar petici√≥n</button>
        </div>
        <ul id="lista-peticiones-usuario" class="lista-peticiones"></ul>
      </div>
    
      <table id="tabla-coordinador">
        <colgroup><col><col><col><col><col><col><col><col></colgroup>
        <thead>
          <tr>
            <th colspan="2">FUNCIONARIO/A</th>
            <th colspan="5" contenteditable="true" class="titulo-ciclo" id="th-ciclo">CICLO</th>
            <th colspan="true">OBSERVACIONES</th>
          </tr>
          <tr>
            <tr><th>N¬∫</th><th>NOMBRE</th><th id="th-m1" contenteditable="true">M¬π</th><th id="th-t1" contenteditable="true">T¬π</th><th id="th-m2" contenteditable="true">M¬≤</th><th id="th-t2" contenteditable="true">T¬≤</th><th id="th-n" contenteditable="true">N</th><th id="th-cocina" contenteditable="true">COCINA</th></tr>
          </tr>
        </thead>
        <tbody>
          <!-- 18 filas de la tabla -->
          <tr><td contenteditable="true"></td><td contenteditable="true"></td><td contenteditable="true"></td><td contenteditable="true"></td><td contenteditable="true"></td><td contenteditable="true"></td><td contenteditable="true"></td><td contenteditable="true"></td></tr>
          <tr><td contenteditable="true"></td><td contenteditable="true"></td><td contenteditable="true"></td><td contenteditable="true"></td><td contenteditable="true"></td><td contenteditable="true"></td><td contenteditable="true"></td><td contenteditable="true"></td></tr>
          <tr><td contenteditable="true"></td><td contenteditable="true"></td><td contenteditable="true"></td><td contenteditable="true"></td><td contenteditable="true"></td><td contenteditable="true"></td><td contenteditable="true"></td><td contenteditable="true"></td></tr>
          <tr><td contenteditable="true"></td><td contenteditable="true"></td><td contenteditable="true"></td><td contenteditable="true"></td><td contenteditable="true"></td><td contenteditable="true"></td><td contenteditable="true"></td><td contenteditable="true"></td></tr>
          <tr><td contenteditable="true"></td><td contenteditable="true"></td><td contenteditable="true"></td><td contenteditable="true"></td><td contenteditable="true"></td><td contenteditable="true"></td><td contenteditable="true"></td><td contenteditable="true"></td></tr>
          <tr><td contenteditable="true"></td><td contenteditable="true"></td><td contenteditable="true"></td><td contenteditable="true"></td><td contenteditable="true"></td><td contenteditable="true"></td><td contenteditable="true"></td><td contenteditable="true"></td></tr>
          <tr><td contenteditable="true"></td><td contenteditable="true"></td><td contenteditable="true"></td><td contenteditable="true"></td><td contenteditable="true"></td><td contenteditable="true"></td><td contenteditable="true"></td><td contenteditable="true"></td></tr>
          <tr><td contenteditable="true"></td><td contenteditable="true"></td><td contenteditable="true"></td><td contenteditable="true"></td><td contenteditable="true"></td><td contenteditable="true"></td><td contenteditable="true"></td><td contenteditable="true"></td></tr>
          <tr><td contenteditable="true"></td><td contenteditable="true"></td><td contenteditable="true"></td><td contenteditable="true"></td><td contenteditable="true"></td><td contenteditable="true"></td><td contenteditable="true"></td><td contenteditable="true"></td></tr>
          <tr><td contenteditable="true"></td><td contenteditable="true"></td><td contenteditable="true"></td><td contenteditable="true"></td><td contenteditable="true"></td><td contenteditable="true"></td><td contenteditable="true"></td><td contenteditable="true"></td></tr>
          <tr><td contenteditable="true"></td><td contenteditable="true"></td><td contenteditable="true"></td><td contenteditable="true"></td><td contenteditable="true"></td><td contenteditable="true"></td><td contenteditable="true"></td><td contenteditable="true"></td></tr>
          <tr><td contenteditable="true"></td><td contenteditable="true"></td><td contenteditable="true"></td><td contenteditable="true"></td><td contenteditable="true"></td><td contenteditable="true"></td><td contenteditable="true"></td><td contenteditable="true"></td></tr>
          <tr><td contenteditable="true"></td><td contenteditable="true"></td><td contenteditable="true"></td><td contenteditable="true"></td><td contenteditable="true"></td><td contenteditable="true"></td><td contenteditable="true"></td><td contenteditable="true"></td></tr>
          <tr><td contenteditable="true"></td><td contenteditable="true"></td><td contenteditable="true"></td><td contenteditable="true"></td><td contenteditable="true"></td><td contenteditable="true"></td><td contenteditable="true"></td><td contenteditable="true"></td></tr>
          <tr><td contenteditable="true"></td><td contenteditable="true"></td><td contenteditable="true"></td><td contenteditable="true"></td><td contenteditable="true"></td><td contenteditable="true"></td><td contenteditable="true"></td><td contenteditable="true"></td></tr>
          <tr><td contenteditable="true"></td><td contenteditable="true"></td><td contenteditable="true"></td><td contenteditable="true"></td><td contenteditable="true"></td><td contenteditable="true"></td><td contenteditable="true"></td><td contenteditable="true"></td></tr>
          <tr><td contenteditable="true"></td><td contenteditable="true"></td><td contenteditable="true"></td><td contenteditable="true"></td><td contenteditable="true"></td><td contenteditable="true"></td><td contenteditable="true"></td><td contenteditable="true"></td></tr>
          <tr><td contenteditable="true"></td><td contenteditable="true"></td><td contenteditable="true"></td><td contenteditable="true"></td><td contenteditable="true"></td><td contenteditable="true"></td><td contenteditable="true"></td><td contenteditable="true"></td></tr>
        </tbody>
      </table>

      <!-- CONTROLES PARA A√ëADIR/QUITAR FILAS -->
      <div id="tabla-coordinador-controles" style="text-align: right; margin-top: 10px; margin-bottom: 15px;">
  <button id="limpiar-tabla" class="modern-btn red">üßπ Limpiar tabla</button>
  <button id="btn-add-row" class="modern-btn green">(+) Fila</button>
  <button id="btn-remove-row" class="modern-btn red">(-) Fila</button>
  <span style="margin-left: 15px;"></span> <!-- Separador visual -->
  <button id="btn-add-col" class="modern-btn" title="A√±adir columna de turno">(+) Col</button>
  <button id="btn-remove-col" class="modern-btn red" title="Eliminar √∫ltima columna de turno">(-) Col</button>
</div>
   </section>

<!-- ========= PANEL 3: TABL√ìN DE ANUNCIOS ========= -->
<section id="tablon-section" class="panel oculto">
    <h2 style="text-align: center;">Tabl√≥n de Anuncios</h2>

    <!-- Contenedor para la previsualizaci√≥n del √∫ltimo archivo -->
    <div id="tablon-preview-container" class="tablon-preview-container oculto">
        <h3>√öltimo archivo subido</h3>
        <img id="tablon-preview-image" src="#" alt="Previsualizaci√≥n del archivo subido" />
    </div>

    <!-- El input de archivo est√° oculto, lo disparamos con el bot√≥n -->
    <input type="file" id="file-input" accept="image/*" style="display: none;">

    <button id="btn-upload-file" class="modern-btn">
        <span class="icon-upload">+</span> Subir Archivo
    </button>
    <div id="tablon-lista"></div>
</section>

<!-- ========= PANEL 4: DOCUMENTOS (AHORA CON LISTAS) ========= -->
<section id="documentos-section" class="panel oculto">
    <h2 style="text-align: center;">Documentos</h2>

    <!-- Input oculto para la subida de PDFs (sin cambios) -->
    <input type="file" id="pdf-input" accept="application/pdf" style="display: none;">

    <!-- Grid para los 4 mini-paneles (estructura interna modificada) -->
    <div class="documentos-grid">

        <!-- Card: Turnos por Mes -->
        <div class="documento-card" data-category="mes">
            <h3>Turnos por Mes</h3>
            <div class="documento-preview-container" title="Ver √∫ltimo PDF subido">
                <div class="preview-overlay"><span class="preview-text">No hay PDFs</span></div>
                <img class="documento-preview-img" alt="Previsualizaci√≥n del √∫ltimo PDF">
            </div>
            <button class="btn-upload-pdf modern-btn" data-category="mes">[+] Subir PDF</button>
            <div class="documento-file-list" id="docs-list-mes"></div>
        </div>

        <!-- Card: Ciclos Especiales -->
        <div class="documento-card" data-category="ciclos">
            <h3>Ciclos Especiales</h3>
            <div class="documento-preview-container" title="Ver √∫ltimo PDF subido">
                <div class="preview-overlay"><span class="preview-text">No hay PDFs</span></div>
                <img class="documento-preview-img" alt="Previsualizaci√≥n del √∫ltimo PDF">
            </div>
            <button class="btn-upload-pdf modern-btn" data-category="ciclos">[+] Subir PDF</button>
            <div class="documento-file-list" id="docs-list-ciclos"></div>
        </div>

        <!-- Card: Vacaciones -->
        <div class="documento-card" data-category="vacaciones">
            <h3>Vacaciones</h3>
            <div class="documento-preview-container" title="Ver √∫ltimo PDF subido">
                <div class="preview-overlay"><span class="preview-text">No hay PDFs</span></div>
                <img class="documento-preview-img" alt="Previsualizaci√≥n del √∫ltimo PDF">
            </div>
            <button class="btn-upload-pdf modern-btn" data-category="vacaciones">[+] Subir PDF</button>
            <div class="documento-file-list" id="docs-list-vacaciones"></div>
        </div>

        <!-- Card: Rotaci√≥n -->
        <div class="documento-card" data-category="rotacion">
            <h3>Rotaci√≥n</h3>
            <div class="documento-preview-container" title="Ver √∫ltimo PDF subido">
                <div class="preview-overlay"><span class="preview-text">No hay PDFs</span></div>
                <img class="documento-preview-img" alt="Previsualizaci√≥n del √∫ltimo PDF">
            </div>
            <button class="btn-upload-pdf modern-btn" data-category="rotacion">[+] Subir PDF</button>
            <div class="documento-file-list" id="docs-list-rotacion"></div>
        </div>

    </div>
</section>

    <!-- ========= NAVEGACI√ìN INFERIOR (CON NOMBRES CORREGIDOS) ========= -->
<nav class="bottom-nav" role="navigation" aria-label="Navegaci√≥n principal">
  <button data-section="turnos" class="nav-btn active">Turnos</button>
  <button data-section="peticiones" class="nav-btn">
             Petici√≥n
             <div class="notification-dot"></div>
           </button>
  <button id="btn-carga-dias" data-section="ajustes" class="nav-btn">Permisos</button>
  <button data-section="documentos" class="nav-btn">
               Docs
               <div class="notification-dot"></div>
             </button>
  <button data-section="tablon" class="nav-btn">
               Tabl√≥n
               <div class="notification-dot"></div>
             </button>
  <button id="btn-install-pwa" class="nav-btn" style="display: none;">‚¨áÔ∏è Instalar</button>
</nav>
</main> 

<!-- ========================================================================= -->
<!-- PANEL DE AUTENTICACI√ìN (LOGIN/REGISTRO)                                 -->
<!-- ========================================================================= -->
<div id="auth-container" class="auth-container">
  <div class="auth-card">
    <img src="logo.svg" alt="TurnApp Logo" class="auth-logo">
    <h2 id="auth-title">Iniciar Sesi√≥n</h2>
    
    <div class="auth-form">
      <input type="email" id="auth-email" placeholder="Correo electr√≥nico" required>
      <input type="password" id="auth-password" placeholder="Contrase√±a" required>
      <p id="auth-error" class="auth-error"></p>
      <button id="auth-submit-btn" class="auth-button">Acceder</button>
    </div>
    
    <p class="auth-toggle-text">
      ¬øNo tienes cuenta? <a href="#" id="auth-toggle-link">Reg√≠strate</a>
    </p>
  </div>
</div>


  <!-- MODAL CADENCIAS (transl√∫cido) -->
  <div id="cadence-modal-overlay" class="modal-overlay" aria-hidden="true" style="display:none;">
    <div id="cadence-modal" class="modal-card" role="dialog" aria-modal="true" aria-labelledby="cadence-title">
      <h3 id="cadence-title">Seleccione la cadencia</h3>

      <div class="modal-section">
        <label class="modal-label">Tipo:</label>
        <div class="modal-row">
          <button data-type="V-1" class="modal-type-btn">V-1</button>
          <button data-type="V-2" class="modal-type-btn">V-2</button>
          <button data-type="Personalizada" class="modal-type-btn">Personalizada</button>
        </div>
      </div>

      <div id="v1-options" class="modal-section" style="display:none;">
        <label class="modal-label">Opciones V-1:</label>
        <div class="modal-row radio-row">
          <label><input type="radio" name="v1opt" value="0"> 1 ‚Äî M/T, L, M/T, N, L, L, L, L</label>
          <label><input type="radio" name="v1opt" value="1"> 2 ‚Äî M/T, M/T, N, L, L, L, L, L</label>
          <label><input type="radio" name="v1opt" value="2"> 3 ‚Äî T, M/T, M/N, L, L, L, L, L</label>
          <label><input type="radio" name="v1opt" value="3"> 4 ‚Äî M/T, N, L, L, L</label>
          <label><input type="radio" name="v1opt" value="4"> 5 ‚Äî T, M/N, L, L, L</label>
        </div>
      </div>

      <div id="v2-options" class="modal-section" style="display:none;">
        <label class="modal-label">V-2: patr√≥n fijo de 6 d√≠as (M/T, M/T, L, L, L, L)</label>
      </div>

      <div id="custom-section" class="modal-section" style="display:none;">
        <label class="modal-label">Patr√≥n personalizado (separado por comas):</label>
        <input id="custom-pattern" type="text" placeholder="ej: M/T, L, M/T, N, L, L, L, L" style="width:100%;padding:8px;border-radius:6px;border:1px solid #ccc;">
      </div>

      <div class="modal-section">
        <label class="modal-label">Fecha inicio (DD/MM/AAAA):</label>
        <input id="cadence-start" type="text" placeholder="DD/MM/AAAA" style="width:140px;padding:8px;border-radius:6px;border:1px solid #ccc;">
      </div>

      <div class="modal-actions">
        <button id="apply-cadence-confirm" class="modal-action primary">Aplicar</button>
        <button id="close-cadence" class="modal-action">Cerrar</button>
      </div>
    </div>
  </div>

  <!-- ====================================================== -->
  <!-- CARGA DE LIBRER√çAS Y CONFIGURACI√ìN DE FIREBASE         -->
  <!-- ====================================================== -->
  <!-- Carga las herramientas de Firebase (versi√≥n compatible) -->
  <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js" defer></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-auth-compat.js" defer></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-firestore-compat.js" defer></script>

  <!-- Carga tus "llaves secretas" de configuraci√≥n -->
  <script src="firebase-config.js" defer></script>

  <!-- ====================================================== -->

  <script src="app.js" defer></script>

<script>
// =========================================================================
// INICIALIZACI√ìN DE LA APP Y L√ìGICA DE AUTENTICACI√ìN
// =========================================================================

// ¬°CORRECCI√ìN! Inicializamos Firebase aqu√≠, al principio de todo.
// Esto asegura que la conexi√≥n est√° lista ANTES de que cualquier otra
// funci√≥n de autenticaci√≥n (como initAuthForm) intente usarla.
firebase.initializeApp(firebaseConfig);

// Esta funci√≥n se encarga de mostrar la app y ocultar el login, o viceversa.
function mostrarPantalla(pantalla) {
    const authContainer = document.getElementById('auth-container');
    const mainApp = document.getElementById('app');

    // Ocultamos todo primero para evitar solapamientos
    if (authContainer) authContainer.style.display = 'none';
    if (mainApp) mainApp.classList.add('oculto');
    
    if (pantalla === 'auth') {
        if (authContainer) authContainer.style.display = 'flex';
    } else if (pantalla === 'app') {
        // La l√≥gica del splash screen original se mover√° aqu√≠
    }
}

// Funci√≥n que contiene TODO el c√≥digo de arranque original de la app
function arrancarAplicacion() {
    // --- 1. ELEMENTOS Y PANELES (A√ëADIDO EL TABL√ìN) ---
    const appContainer = document.getElementById('app');
    const mainContent = document.getElementById('content');
    const ajustesSection = document.getElementById('ajustes-section');
    const tablonSection = document.getElementById('tablon-section');
    const documentosSection = document.getElementById('documentos-section');
    const licenciasContainer = document.getElementById('licencias-container');
    const calendarPanel = document.getElementById('calendar-panel');
    
    const navButtons = document.querySelectorAll('.nav-btn');
    const btnTurnos = document.querySelector('.nav-btn[data-section="turnos"]');
    const btnPeticiones = document.querySelector('.nav-btn[data-section="peticiones"]');
    const btnTablon = document.querySelector('.nav-btn[data-section="tablon"]');
    const btnDocumentos = document.querySelector('.nav-btn[data-section="documentos"]');
    const btnCargaDias = document.getElementById('btn-carga-dias');

    // --- 2. L√ìGICA DE NAVEGACI√ìN (MODIFICADA PARA EL TABL√ìN) ---
    function switchPanel(targetSection) {
        mainContent.classList.add('oculto');
        ajustesSection.classList.add('oculto');
        tablonSection.classList.add('oculto');
        documentosSection.classList.add('oculto');
        licenciasContainer.classList.add('oculto');

        if (targetSection === 'turnos') {
            mainContent.classList.remove('oculto');
            appContainer.scrollIntoView({ behavior: 'smooth', block: 'start' });
        } else if (targetSection === 'peticiones') {
            ajustesSection.classList.remove('oculto');
            ajustesSection.scrollIntoView({ behavior: 'smooth', block: 'start' });
        } else if (targetSection === 'tablon') {
            tablonSection.classList.remove('oculto');
            tablonSection.scrollIntoView({ behavior: 'smooth', block: 'start' });
        }
         else if (targetSection === 'documentos') {
            documentosSection.classList.remove('oculto');
            documentosSection.scrollIntoView({ behavior: 'smooth', block: 'start' });
        }
        navButtons.forEach(btn => {
            btn.classList.toggle('active', btn.dataset.section === targetSection);
        });
    }
    btnTurnos.addEventListener('click', () => { switchPanel('turnos'); });
    btnPeticiones.addEventListener('click', () => { switchPanel(ajustesSection.classList.contains('oculto') ? 'peticiones' : 'turnos'); });
    btnTablon.addEventListener('click', () => { switchPanel(tablonSection.classList.contains('oculto') ? 'tablon' : 'turnos'); });
    btnDocumentos.addEventListener('click', () => { switchPanel(documentosSection.classList.contains('oculto') ? 'documentos' : 'turnos'); });
    btnCargaDias.addEventListener('click', () => {
        if (mainContent.classList.contains('oculto')) { switchPanel('turnos'); }
        if (licenciasContainer.classList.contains('oculto')) {
            licenciasContainer.classList.remove('oculto');
            licenciasContainer.scrollIntoView({ behavior: 'smooth', block: 'start' });
        } else {
            licenciasContainer.classList.add('oculto');
            calendarPanel.scrollIntoView({ behavior: 'smooth', block: 'start' });
        }
    });

    // --- 3. L√ìGICA DE C√ÅLCULO DE LICENCIAS (INTACTA) ---
    // Esta l√≥gica la moveremos a app.js m√°s adelante, por ahora se queda.
    
    // --- 4. L√ìGICA PWA (INTACTA) ---
    let deferredPrompt;
    const installButton = document.getElementById('btn-install-pwa');
    window.addEventListener('beforeinstallprompt', (e) => {
      e.preventDefault();
      deferredPrompt = e;
      if (installButton) { installButton.style.display = 'block'; }
    });
    if (installButton) {
      installButton.addEventListener('click', async () => {
        if (deferredPrompt) {
          deferredPrompt.prompt();
          await deferredPrompt.userChoice;
          deferredPrompt = null;
          installButton.style.display = 'none';
        }
      });
    }
    window.addEventListener('appinstalled', () => {
      if (installButton) { installButton.style.display = 'none'; }
      deferredPrompt = null;
    });

    // --- PUNTO DE ARRANQUE VISUAL ---
    // Quitamos la pantalla de login/registro y mostramos la app principal (con el splash)
    const authContainer = document.getElementById('auth-container');
    const splashScreen = document.getElementById('splash');
    const mainApp = document.getElementById('app');

    if (authContainer) authContainer.style.display = 'none';
    if (splashScreen) splashScreen.style.display = 'block';
    if (mainApp) mainApp.classList.remove('oculto'); // Mostramos el contenedor de la app

    // Volvemos a poner en marcha la l√≥gica del splash screen que estaba en app.js
    const logo = document.getElementById("splash-logo");
    const calendarioSection = document.getElementById("calendar-panel");
    const licenciasSection = document.getElementById("licencias-container");

    if (splashScreen && mainApp && logo && calendarioSection && licenciasSection) {
        mainApp.classList.add("oculto"); // Ocultamos la app principal al inicio
        calendarioSection.classList.add("oculto");
        licenciasSection.classList.add("oculto");
        
        // El splash se muestra por defecto, no hace falta tocarlo.
        
        logo.addEventListener("click", () => {
            splashScreen.remove();
            mainApp.classList.remove("oculto");
            calendarioSection.classList.remove("oculto");
            licenciasSection.classList.add("oculto");
            calendarioSection.classList.add("fade-in-up");
            setTimeout(() => { mainApp.scrollIntoView({ behavior: "smooth", block: "start" }); }, 50);
        });
    }

    // Finalmente, inicializamos todos los m√≥dulos de app.js
    // ¬°IMPORTANTE! Nos aseguramos de que estas funciones existan antes de llamarlas.
    if(typeof initThemeSwitcher === 'function') initThemeSwitcher();
    if(typeof initApp === 'function') initApp();
    if(typeof initCoordinatorTable === 'function') initCoordinatorTable();
    if(typeof initTablon === 'function') initTablon();
    if(typeof initDocumentosPanel === 'function') initDocumentosPanel();
    if(typeof initPeticiones === 'function') initPeticiones();
    if(typeof initEditableTitle === 'function') initEditableTitle();
    if(typeof initLicenciasPanel === 'function') initLicenciasPanel();
    if(typeof initNotificationManager === 'function') initNotificationManager();

    switchPanel('turnos'); // Empezamos en la vista de turnos
}

// Observador del estado de autenticaci√≥n de Firebase
firebase.auth().onAuthStateChanged(user => {
    if (user) {
        // --- Usuario AUTENTICADO ---
        console.log('Usuario autenticado:', user.email);
        arrancarAplicacion(); // Llamamos a la funci√≥n que pone en marcha toda la app
    } else {
        // --- Usuario NO AUTENTICADO ---
        console.log('No hay usuario autenticado.');
        mostrarPantalla('auth'); // Mostramos la pantalla de login/registro
    }
});

// Funci√≥n para inicializar los listeners del formulario de login/registro
function initAuthForm() {
    const emailInput = document.getElementById('auth-email');
    const passwordInput = document.getElementById('auth-password');
    const submitBtn = document.getElementById('auth-submit-btn');
    const toggleLink = document.getElementById('auth-toggle-link');
    const authTitle = document.getElementById('auth-title');
    const errorContainer = document.getElementById('auth-error');

    if (!submitBtn) return; // Si no existe el formulario, no hacemos nada

    let isLoginMode = true;

    toggleLink.addEventListener('click', (e) => {
        e.preventDefault();
        isLoginMode = !isLoginMode;
        authTitle.textContent = isLoginMode ? 'Iniciar Sesi√≥n' : 'Crear Cuenta';
        submitBtn.textContent = isLoginMode ? 'Acceder' : 'Registrarse';
        toggleLink.previousSibling.textContent = isLoginMode ? '¬øNo tienes cuenta? ' : '¬øYa tienes cuenta? ';
        toggleLink.textContent = isLoginMode ? 'Reg√≠strate' : 'Inicia sesi√≥n';
        errorContainer.textContent = '';
    });

    submitBtn.addEventListener('click', () => {
        const email = emailInput.value;
        const password = passwordInput.value;
        errorContainer.textContent = '';
        if (!email || !password) {
            errorContainer.textContent = 'Por favor, introduce email y contrase√±a.';
            return;
        }
        if (isLoginMode) {
            firebase.auth().signInWithEmailAndPassword(email, password)
                .catch(error => { errorContainer.textContent = 'Error: ' + error.message; });
        } else {
            firebase.auth().createUserWithEmailAndPassword(email, password)
                .catch(error => { errorContainer.textContent = 'Error: ' + error.message; });
        }
    });
}

// Llamamos a la funci√≥n para que el formulario de login est√© activo desde el principio.
initAuthForm();

</script>


<!-- Contenedor Modal para la visualizaci√≥n de im√°genes a pantalla completa -->
<div id="image-modal" class="image-modal-overlay oculto">
  <span class="image-modal-close">&times;</span>
  <img class="image-modal-content" id="modal-image-content">
</div>

<!-- Contenedor Modal para la visualizaci√≥n de PDFs a pantalla completa -->
<div id="pdf-modal" class="image-modal-overlay oculto">
  <span class="image-modal-close">&times;</span>
  <iframe class="pdf-modal-content" id="modal-pdf-content"></iframe>
</div>


</body>
</html>