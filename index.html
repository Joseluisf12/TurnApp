<!doctype html>
<html lang="es">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <meta name="theme-color" content="#0b5ed7">
  <title>TurnApp ‚Äî Gesti√≥n Inteligente de Turnos de Trabajo</title>
  <link rel="manifest" href="manifest.json">
  <link rel="stylesheet" href="app.css">
</head>
<body class="light">

  <!-- Pantalla inicial / Splash -->
  <div id="splash" class="splash">
    <div class="logo-wrap">
      <img src="logo.svg" alt="TurnApp logo" class="logo-img">
    </div>
    <h1 class="slogan">Gesti√≥n Inteligente de Turnos de Trabajo</h1>
  </div>

  <!-- App principal -->
  <main id="app">
    <header class="app-header">
      <h2 id="app-title">TurnApp</h2>
      <button id="btn-toggle-theme" class="icon-btn" aria-label="Cambiar tema">üåì</button>
    </header>

    <section id="content" class="content">
      <p>Bienvenido a <strong>TurnApp</strong>, tu gestor inteligente de turnos de trabajo.</p>

      <!-- Botones de cadencia -->
      <div style="margin-top:12px; margin-bottom:25px; text-align:center;">
        <button id="btn-apply-cadence" class="modern-btn green">Aplicar cadencia</button>
        <button id="btn-clear-cadence" class="modern-btn red">Limpiar cadencia</button>
      </div>

      <div class="calendar-controls">
        <button id="prevMonth">‚óÄ Mes anterior</button>
        <span id="monthLabel"></span>
        <button id="nextMonth">Siguiente mes ‚ñ∂</button>
      </div>

      <section id="calendar-panel" class="panel">
  <div id="calendar"></div>
</section>

      <!-- Contenedor de licencias -->
      <div id="licencias-container" class="licencias" aria-hidden="true" style="display:block; margin-top:20px;">
        <h3>Gesti√≥n de Permisos y Licencias</h3>

        <div class="licencia-item" data-tipo="vacaciones">
          <label class="licencia-nombre">Vacaciones:  V</label>
          <input type="number" min="0" class="cantidad-input licencia-cantidad" value="0">
          <button type="button" class="licencia-color-handle licencia-color" title="Elegir color">‚óè</button>
        </div>

        <div class="licencia-item" data-tipo="compfest">
          <label class="licencia-nombre">Compensaci√≥n de Festivos:  CF</label>
          <input type="number" min="0" class="cantidad-input licencia-cantidad" value="0">
          <button type="button" class="licencia-color-handle licencia-color" title="Elegir color">‚óè</button>
        </div>

        <div class="licencia-item" data-tipo="asuntos">
          <label class="licencia-nombre">Asuntos Propios:  AP</label>
          <input type="number" min="0" class="cantidad-input licencia-cantidad" value="0">
          <button type="button" class="licencia-color-handle licencia-color" title="Elegir color">‚óè</button>
        </div>

        <div class="licencia-item" data-tipo="delegacion">
          <label class="licencia-nombre">Delegaci√≥n de Gobierno:  DG</label>
          <input type="number" min="0" class="cantidad-input licencia-cantidad" value="0">
          <button type="button" class="licencia-color-handle licencia-color" title="Elegir color">‚óè</button>
        </div>

        <div class="licencia-item" data-tipo="adicionales">
          <label class="licencia-nombre">D√≠as Adicionales:  DA</label>
          <input type="number" min="0" class="cantidad-input licencia-cantidad" value="0">
          <button type="button" class="licencia-color-handle licencia-color" title="Elegir color">‚óè</button>
        </div>

        <div class="licencia-item" data-tipo="acumuladas">
          <label class="licencia-nombre">Jornadas Acumuladas:  JA</label>
          <input type="number" min="0" class="cantidad-input licencia-cantidad" value="0">
          <button type="button" class="licencia-color-handle licencia-color" title="Elegir color">‚óè</button>
        </div>

        <div class="licencia-item" data-tipo="otros">
          <label class="licencia-nombre">Otros:  O</label>
          <input type="number" min="0" class="cantidad-input licencia-cantidad" value="0">
          <button type="button" class="licencia-color-handle licencia-color" title="Elegir color">‚óè</button>
        </div>

        <!-- Nuevas licencias a√±adidas (tal como pediste) -->
        <div class="licencia-item" data-tipo="baja_medica">
          <label class="licencia-nombre">Baja M√©dica:  BM</label>
          <input type="number" min="0" class="cantidad-input licencia-cantidad" value="0">
          <button type="button" class="licencia-color-handle licencia-color" title="Elegir color">‚óè</button>
        </div>

        <div class="licencia-item" data-tipo="articulo_48">
          <label class="licencia-nombre">Art√≠culo 48:  AR</label>
          <input type="number" min="0" class="cantidad-input licencia-cantidad" value="0">
          <button type="button" class="licencia-color-handle licencia-color" title="Elegir color">‚óè</button>
        </div>

        <div class="licencia-item" data-tipo="deber_inexcusable">
          <label class="licencia-nombre">Deber Inexcusable:  DI</label>
          <input type="number" min="0" class="cantidad-input licencia-cantidad" value="0">
          <button type="button" class="licencia-color-handle licencia-color" title="Elegir color">‚óè</button>
        </div>

        <hr>

        <div class="licencia-total">
          <label class="licencia-nombre"><strong>Total:</strong></label>
          <input type="text" id="total-licencias" readonly class="licencia-cantidad" value="0">
        </div>
      </div>
    </section>
<!-- Caj√≥n de Peticiones -->
<section id="peticiones-section" class="panel oculto">
  <h2>Gesti√≥n de Peticiones</h2>

  <!-- Zona Usuario -->
  <div class="peticiones-zona">
    <h3>Zona Usuario</h3>
    <textarea id="peticion-texto" placeholder="Escribe aqu√≠ tu petici√≥n..."></textarea>
    <div class="peticiones-controles">
      <button id="enviar-peticion">Enviar petici√≥n</button>
    </div>
    <ul id="lista-peticiones-usuario" class="lista-peticiones"></ul>
  </div>

    <!-- Zona Coordinador -->
  <div class="peticiones-zona">
    <h3>Zona Coordinador</h3>
    <ul id="lista-peticiones-admin" class="lista-peticiones"></ul>

    <!-- === EXCEL DEL COORDINADOR === -->
    <div id="tabla-coordinador" class="panel">
      <h3>üìä Pr√≥ximo Ciclo</h3>
      <div id="excel-coordinador-container">
        <table id="tabla-coordinador">
          <thead>
            <tr>
              <th colspan="3">FUNCIONARIO/A</th>
              <th colspan="5">CICLO</th>
              <th rowspan="2">OBSERVACIONES</th>
            </tr>
            <tr>
              <th>ORDEN</th>
              <th>N¬∫</th>
              <th>NOMBRE</th>
              <th>M </th>
              <th>T </th>
              <th>M </th>
              <th>T </th>
              <th>N </th>
            </tr>
          </thead>
          <tbody>
            <!-- 18 filas vac√≠as editables -->
            <tr><td contenteditable="true"></td><td contenteditable="true"></td><td contenteditable="true"></td><td contenteditable="true"></td><td contenteditable="true"></td><td contenteditable="true"></td><td contenteditable="true"></td><td contenteditable="true"></td><td contenteditable="true"></td></tr>
            <tr><td contenteditable="true"></td><td contenteditable="true"></td><td contenteditable="true"></td><td contenteditable="true"></td><td contenteditable="true"></td><td contenteditable="true"></td><td contenteditable="true"></td><td contenteditable="true"></td><td contenteditable="true"></td></tr>
            <tr><td contenteditable="true"></td><td contenteditable="true"></td><td contenteditable="true"></td><td contenteditable="true"></td><td contenteditable="true"></td><td contenteditable="true"></td><td contenteditable="true"></td><td contenteditable="true"></td><td contenteditable="true"></td></tr>
            <tr><td contenteditable="true"></td><td contenteditable="true"></td><td contenteditable="true"></td><td contenteditable="true"></td><td contenteditable="true"></td><td contenteditable="true"></td><td contenteditable="true"></td><td contenteditable="true"></td><td contenteditable="true"></td></tr>
            <tr><td contenteditable="true"></td><td contenteditable="true"></td><td contenteditable="true"></td><td contenteditable="true"></td><td contenteditable="true"></td><td contenteditable="true"></td><td contenteditable="true"></td><td contenteditable="true"></td><td contenteditable="true"></td></tr>
            <tr><td contenteditable="true"></td><td contenteditable="true"></td><td contenteditable="true"></td><td contenteditable="true"></td><td contenteditable="true"></td><td contenteditable="true"></td><td contenteditable="true"></td><td contenteditable="true"></td><td contenteditable="true"></td></tr>
            <tr><td contenteditable="true"></td><td contenteditable="true"></td><td contenteditable="true"></td><td contenteditable="true"></td><td contenteditable="true"></td><td contenteditable="true"></td><td contenteditable="true"></td><td contenteditable="true"></td><td contenteditable="true"></td></tr>
            <tr><td contenteditable="true"></td><td contenteditable="true"></td><td contenteditable="true"></td><td contenteditable="true"></td><td contenteditable="true"></td><td contenteditable="true"></td><td contenteditable="true"></td><td contenteditable="true"></td><td contenteditable="true"></td></tr>
            <tr><td contenteditable="true"></td><td contenteditable="true"></td><td contenteditable="true"></td><td contenteditable="true"></td><td contenteditable="true"></td><td contenteditable="true"></td><td contenteditable="true"></td><td contenteditable="true"></td><td contenteditable="true"></td></tr>
            <tr><td contenteditable="true"></td><td contenteditable="true"></td><td contenteditable="true"></td><td contenteditable="true"></td><td contenteditable="true"></td><td contenteditable="true"></td><td contenteditable="true"></td><td contenteditable="true"></td><td contenteditable="true"></td></tr>
            <tr><td contenteditable="true"></td><td contenteditable="true"></td><td contenteditable="true"></td><td contenteditable="true"></td><td contenteditable="true"></td><td contenteditable="true"></td><td contenteditable="true"></td><td contenteditable="true"></td><td contenteditable="true"></td></tr>
            <tr><td contenteditable="true"></td><td contenteditable="true"></td><td contenteditable="true"></td><td contenteditable="true"></td><td contenteditable="true"></td><td contenteditable="true"></td><td contenteditable="true"></td><td contenteditable="true"></td><td contenteditable="true"></td></tr>
            <tr><td contenteditable="true"></td><td contenteditable="true"></td><td contenteditable="true"></td><td contenteditable="true"></td><td contenteditable="true"></td><td contenteditable="true"></td><td contenteditable="true"></td><td contenteditable="true"></td><td contenteditable="true"></td></tr>
            <tr><td contenteditable="true"></td><td contenteditable="true"></td><td contenteditable="true"></td><td contenteditable="true"></td><td contenteditable="true"></td><td contenteditable="true"></td><td contenteditable="true"></td><td contenteditable="true"></td><td contenteditable="true"></td></tr>
            <tr><td contenteditable="true"></td><td contenteditable="true"></td><td contenteditable="true"></td><td contenteditable="true"></td><td contenteditable="true"></td><td contenteditable="true"></td><td contenteditable="true"></td><td contenteditable="true"></td><td contenteditable="true"></td></tr>
            <tr><td contenteditable="true"></td><td contenteditable="true"></td><td contenteditable="true"></td><td contenteditable="true"></td><td contenteditable="true"></td><td contenteditable="true"></td><td contenteditable="true"></td><td contenteditable="true"></td><td contenteditable="true"></td></tr>
            <tr><td contenteditable="true"></td><td contenteditable="true"></td><td contenteditable="true"></td><td contenteditable="true"></td><td contenteditable="true"></td><td contenteditable="true"></td><td contenteditable="true"></td><td contenteditable="true"></td><td contenteditable="true"></td></tr>
            <tr><td contenteditable="true"></td><td contenteditable="true"></td><td contenteditable="true"></td><td contenteditable="true"></td><td contenteditable="true"></td><td contenteditable="true"></td><td contenteditable="true"></td><td contenteditable="true"></td><td contenteditable="true"></td></tr>
          </tbody>
        </table>
      </div>
    </div>
  </div>
</section>


    <nav class="bottom-nav" role="navigation" aria-label="Navegaci√≥n principal">
      <button data-section="turnos" class="nav-btn active">Turnos</button>
      <button id="btn-peticiones" type="button" data-section="peticiones" class="nav-btn">Peticiones</button>

      <button data-section="ajustes" class="nav-btn" id="btn-carga-dias">Carga D√≠as</button>
    </nav>
  </main>

  <!-- MODAL CADENCIAS (transl√∫cido) -->
  <div id="cadence-modal-overlay" class="modal-overlay" aria-hidden="true" style="display:none;">
    <div id="cadence-modal" class="modal-card" role="dialog" aria-modal="true" aria-labelledby="cadence-title">
      <h3 id="cadence-title">Seleccione la cadencia</h3>

      <div class="modal-section">
        <label class="modal-label">Tipo:</label>
        <div class="modal-row">
          <button data-type="V-1" class="modal-type-btn">V-1</button>
          <button data-type="V-2" class="modal-type-btn">V-2</button>
          <button data-type="Personalizada" class="modal-type-btn">Personalizada</button>
        </div>
      </div>

      <div id="v1-options" class="modal-section" style="display:none;">
        <label class="modal-label">Opciones V-1:</label>
        <div class="modal-row radio-row">
          <label><input type="radio" name="v1opt" value="0"> 1 ‚Äî M/T, L, M/T, N, L, L, L, L</label>
          <label><input type="radio" name="v1opt" value="1"> 2 ‚Äî M/T, M/T, N, L, L, L, L, L</label>
          <label><input type="radio" name="v1opt" value="2"> 3 ‚Äî T, M/T, M/N, L, L, L, L, L</label>
          <label><input type="radio" name="v1opt" value="3"> 4 ‚Äî M/T, N, L, L, L</label>
          <label><input type="radio" name="v1opt" value="4"> 5 ‚Äî T, M/N, L, L, L</label>
        </div>
      </div>

      <div id="v2-options" class="modal-section" style="display:none;">
        <label class="modal-label">V-2: patr√≥n fijo de 6 d√≠as (M/T, M/T, L, L, L, L)</label>
      </div>

      <div id="custom-section" class="modal-section" style="display:none;">
        <label class="modal-label">Patr√≥n personalizado (separado por comas):</label>
        <input id="custom-pattern" type="text" placeholder="ej: M/T, L, M/T, N, L, L, L, L" style="width:100%;padding:8px;border-radius:6px;border:1px solid #ccc;">
      </div>

      <div class="modal-section">
        <label class="modal-label">Fecha inicio (DD/MM/AAAA):</label>
        <input id="cadence-start" type="text" placeholder="DD/MM/AAAA" style="width:140px;padding:8px;border-radius:6px;border:1px solid #ccc;">
      </div>

      <div class="modal-actions">
        <button id="apply-cadence-confirm" class="modal-action primary">Aplicar</button>
        <button id="close-cadence" class="modal-action">Cerrar</button>
      </div>
    </div>
  </div>

  <script src="app.js" defer></script>

  <script>
    // peque√±o script para toggle del contenedor licencias y scroll (no toca nada m√°s)
    document.addEventListener('DOMContentLoaded', () => {
      const btnCarga = document.getElementById('btn-carga-dias');
      const licencias = document.getElementById('licencias-container');
      const calendar = document.getElementById('calendar');
      if(!btnCarga || !licencias || !calendar) return;

      btnCarga.addEventListener('click', () => {
        const isHidden = licencias.style.display === 'none' || licencias.classList.contains('hidden');
        if(isHidden){
          licencias.style.display = 'block';
          licencias.classList.remove('hidden');
          licencias.setAttribute('aria-hidden','false');
          setTimeout(()=> licencias.scrollIntoView({behavior:'smooth', block:'start'}), 50);
        } else {
          licencias.style.display = 'none';
          licencias.classList.add('hidden');
          licencias.setAttribute('aria-hidden','true');
          setTimeout(()=> calendar.scrollIntoView({behavior:'smooth', block:'start'}), 50);
        }
      });

      // total licencias
      const inputs = Array.from(document.querySelectorAll('.cantidad-input'));
      const totalField = document.getElementById('total-licencias');
      const recalc = () => {
        let total = 0;
        inputs.forEach(i => total += Number(i.value)||0);
        totalField.value = total;
      };
      inputs.forEach(i=> i.addEventListener('input', recalc));
      recalc();
    });
 </script>
<script>
document.addEventListener('DOMContentLoaded', () => {
  const textoPeticion = document.getElementById('peticion-texto');
  const botonEnviar = document.getElementById('enviar-peticion');
  const listaUsuario = document.getElementById('lista-peticiones-usuario');
  const listaAdmin = document.getElementById('lista-peticiones-admin');

  // Simulaci√≥n: definir si el usuario actual es admin
  const esAdmin = true; // cambia a false si quieres probar la vista de usuario normal

  // Crear botones de borrado total (uno por zona)
  const botonBorrarUsuario = document.createElement('button');
  botonBorrarUsuario.textContent = 'üßπ Borrar Peticiones';
  botonBorrarUsuario.className = 'btn-borrar-todo';
  botonBorrarUsuario.style.display = esAdmin ? 'inline-block' : 'none';
  listaUsuario.parentElement.appendChild(botonBorrarUsuario);

  const botonBorrarAdmin = document.createElement('button');
  botonBorrarAdmin.textContent = 'üßπ Borrar Peticiones';
  botonBorrarAdmin.className = 'btn-borrar-todo';
  botonBorrarAdmin.style.display = esAdmin ? 'inline-block' : 'none';
  listaAdmin.parentElement.appendChild(botonBorrarAdmin);

  // Recuperar peticiones guardadas
  const peticionesUsuario = JSON.parse(localStorage.getItem('peticionesUsuario') || '[]');
  const peticionesAdmin = JSON.parse(localStorage.getItem('peticionesAdmin') || '[]');

  // Renderizar peticiones
  peticionesUsuario.forEach((p, idx) => agregarPeticionUsuario(p, idx));
  peticionesAdmin.forEach((p, idx) => agregarPeticionAdmin(p, idx));

  // Enviar nueva petici√≥n
  botonEnviar.addEventListener('click', () => {
    const texto = textoPeticion.value.trim();
    if (!texto) {
      alert('Por favor escribe una petici√≥n antes de enviarla.');
      return;
    }

    const fechaHora = new Date().toLocaleString();
    const nueva = { texto, revisada: false, fechaHora };

    // Guardar en ambas listas
    peticionesUsuario.push(nueva);
    peticionesAdmin.push({ texto });
    localStorage.setItem('peticionesUsuario', JSON.stringify(peticionesUsuario));
    localStorage.setItem('peticionesAdmin', JSON.stringify(peticionesAdmin));

    agregarPeticionUsuario(nueva, peticionesUsuario.length - 1);
    agregarPeticionAdmin({ texto }, peticionesAdmin.length - 1);
    textoPeticion.value = '';
  });

  // --- Funci√≥n: agregar a zona Usuario ---
  function agregarPeticionUsuario(p, idx) {
    const li = document.createElement('li');
    li.className = 'peticion-item';

    const check = document.createElement('input');
    check.type = 'checkbox';
    check.checked = p.revisada;
    check.addEventListener('change', () => {
      peticionesUsuario[idx].revisada = check.checked;
      localStorage.setItem('peticionesUsuario', JSON.stringify(peticionesUsuario));
    });

    const span = document.createElement('span');
span.textContent = p.texto;

const fechaSpan = document.createElement('span');
fechaSpan.className = 'fecha-hora';
fechaSpan.textContent = p.fechaHora;

li.appendChild(check);
li.appendChild(span);
li.appendChild(fechaSpan);


    // Bot√≥n individual de borrado (solo admin)
    if (esAdmin) {
      const btnDel = document.createElement('button');
      btnDel.textContent = '‚ùå';
      btnDel.className = 'btn-eliminar';
      btnDel.style.marginLeft = '8px';
      btnDel.addEventListener('click', () => {
        peticionesUsuario.splice(idx, 1);
        localStorage.setItem('peticionesUsuario', JSON.stringify(peticionesUsuario));
        recargarListas();
      });
      li.appendChild(btnDel);
    }

    listaUsuario.appendChild(li);
  }

  // --- Funci√≥n: agregar a zona Administrador ---
  function agregarPeticionAdmin(p, idx) {
    const li = document.createElement('li');
    li.className = 'peticion-item';
    li.textContent = p.texto;

    if (esAdmin) {
      const btnDel = document.createElement('button');
      btnDel.textContent = '‚ùå';
      btnDel.className = 'btn-eliminar';
      btnDel.style.marginLeft = '8px';
      btnDel.addEventListener('click', () => {
        peticionesAdmin.splice(idx, 1);
        localStorage.setItem('peticionesAdmin', JSON.stringify(peticionesAdmin));
        recargarListas();
      });
      li.appendChild(btnDel);
    }

    listaAdmin.appendChild(li);
  }

  // --- Botones de borrado total (cada uno borra su zona) ---
  botonBorrarUsuario.addEventListener('click', () => {
    if (confirm('¬øSeguro que quieres borrar las peticiones de la zona de Usuario?')) {
      peticionesUsuario.length = 0;
      localStorage.setItem('peticionesUsuario', '[]');
      recargarListas();
    }
  });

  botonBorrarAdmin.addEventListener('click', () => {
    if (confirm('¬øSeguro que quieres borrar las peticiones de la zona de Administrador?')) {
      peticionesAdmin.length = 0;
      localStorage.setItem('peticionesAdmin', '[]');
      recargarListas();
    }
  });

  // --- Recargar ambas zonas ---
  function recargarListas() {
    listaUsuario.innerHTML = '';
    listaAdmin.innerHTML = '';
    const nuevasU = JSON.parse(localStorage.getItem('peticionesUsuario') || '[]');
    const nuevasA = JSON.parse(localStorage.getItem('peticionesAdmin') || '[]');
    nuevasU.forEach((p, idx) => agregarPeticionUsuario(p, idx));
    nuevasA.forEach((p, idx) => agregarPeticionAdmin(p, idx));
  }
});
</script>
<script>
document.addEventListener("DOMContentLoaded", () => {
  const calendar = document.getElementById("calendar");
  const peticionesSection = document.getElementById("peticiones-section");
  const peticionesBtn = document.querySelector('button[data-section="peticiones"]');

  // üîπ Asegura que el calendario siempre est√© visible
  if (calendar) {
    calendar.classList.remove("oculto");
    calendar.style.display = "grid";
  }

  // üîπ Si no hay bot√≥n o secci√≥n, salimos
  if (!peticionesBtn || !peticionesSection) return;

  // üîπ Alternar visibilidad del caj√≥n de peticiones + scroll suave
  peticionesBtn.addEventListener("click", () => {
    const visible = !peticionesSection.classList.contains("oculto");

    if (visible) {
      // üî∏ Ocultar el caj√≥n
      peticionesSection.classList.add("oculto");
      peticionesSection.style.display = "none";
      // üî∏ Scroll hacia el calendario
      setTimeout(() => {
        calendar.scrollIntoView({ behavior: "smooth", block: "start" });
      }, 100);
    } else {
      // üî∏ Mostrar el caj√≥n
      peticionesSection.classList.remove("oculto");
      peticionesSection.style.display = "block";
      // üî∏ Scroll hacia el caj√≥n
      setTimeout(() => {
        peticionesSection.scrollIntoView({ behavior: "smooth", block: "start" });
      }, 100);
    }
  });
});
</script>


</body>
</html>
